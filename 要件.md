# 請求管理システム 仕様書

## 1. プロジェクト概要
* **サービス名:** かんたん清掃報告
* **目的:** 清掃スタッフが清掃業務を簡単に報告し、管理者が月末に一括して請求書（PDF）を発行・ダウンロードできるようにする。
* **ターゲット:** ITに不慣れな清掃スタッフ（スマートフォン操作）

## 2. 技術要件（コスト0円構成）
* **プラットフォーム:** Google Apps Script (GAS)
* **データベース:** Google スプレッドシート
* **フロントエンド:** スマホで見ることを前提としてるのでレスポンシブル対応必須
* **認証:** 4桁の暗証番号による簡易認証。
  - Webページを開いた際に一度だけ入力を求める。
  - ブラウザの SessionStorage 等を利用し、30分程度は再入力不要（セッション維持）とする。
無料でできるなら技術要件はこれ以外でも可。もっといいのがあれば提案歓迎する。

## 3. 機能要件

### 3.1 メインダッシュボード
* **入力切り替え:** 「清掃報告（業務）」と「立替費用報告」の2つの入力窓口を設ける。

### 3.2 清掃報告フォーム（業務内容）
* **日付:** デフォルト当日。未来日不可、過去日選択可。
* **動的入力フォーム:** - 1行目はデフォルトで「通常清掃」を選択済み。
  - 「＋」ボタンで入力行を自由に追加でき、一度の送信で複数の業務（例：通常清掃＋追加業務）を報告可能。
* **選択項目:**
  1. 通常清掃（固定報酬: 1,100円）
  2. 追加業務（時給: 1,800円）
  3. 緊急対応（時給: 2,000円）
* **作業時間:** 15分単位のプルダウン形式（0:15 〜 3:00）。「追加業務」「緊急対応」時のみ表示。
* **備考:** 自由入力。「通常清掃」以外の場合は入力必須。

### 3.3 立替費用報告フォーム（別窓口）
* **発生日:** 清掃日とは別に日付を選択可能。
* **内容:** 購入品目などの名称を入力。
* **金額:** 数値入力。
* **送信:** 清掃報告とは独立して単体で送信可能。

### 3.4 管理・履歴確認機能
* **履歴リスト:** 当月分の全データ（業務・立替の両方）を一覧表示。合計請求金額（税込）を大きく表示。
* **修正・削除:** リストから各レコードの編集および削除が可能。

### 3.5 請求書発行機能（管理者用）
* **対象月選択:** 発行したい月を選択（デフォルトは先月）。
* **PDF生成:** スプレッドシートのテンプレートを元にPDFを生成し、ローカルにダウンロードする。

## 4. データ構造（Google スプレッドシート）

### A. 実績データシート
| カラム名 | 説明 |
| :--- | :--- |
| ID | ユニークID（UUID等） |
| 日付 | 業務実施日または立替日 |
| カテゴリ | 業務 / 立替 |
| 項目名 | 通常清掃 / 追加業務 / 緊急対応 / 立替品目名 |
| 単価 | 1,100 / 1,800 / 2,000 / (立替時は空) |
| 作業時間(分) | 15分単位の数値 |
| 小計 | 計算済みの金額 |
| 備考 | スタッフによるメモ |
| 作成日時 | 登録時のタイムスタンプ |

### B. 設定シート
* **暗証番号:** 4桁の固定値
* **請求者名:** 田中 太郎（固定）
* **宛名:** 桑原 宏和（固定）

## 5. 計算ロジック
* **通常清掃:** 1回あたり 1,100円
* **時間給:** `時給 × (作業分 / 60)` で算出。15分単位で計算する（30分切り上げルールは適用しない）。
* **端数処理:** 円未満切り捨て。
* **消費税:** 全て「税込」として扱う。

## 6. 請求書PDFのデザイン仕様
* **タイトル:** 請求書
* **宛名:** 桑原 宏和 様
* **請求者:** 田中 太郎
* **対象月:** 「20XX年XX月分」
* **明細項目:** 4カテゴリ（通常清掃、追加時給、緊急時給、立替費用）で集計して表示。
* **振込先:** 記載不要（枠ごと削除）。
* **備考欄:** 以下の固定文言を記載。
  - 「追加時給は15分単位で計上しています。」

## 7. セキュリティ・運用ルール
* **個人情報:** システム内に銀行口座情報などは保持しない。
* **修正:** 業者自身で過去データの修正・削除を可能とする（認証済みユーザーのみ）。
